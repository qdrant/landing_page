<!--course content layout, dedicated layout for course pages-->
<section class="docs documentation">
  <div class="documentation__container">
    <div class="d-flex flex-column flex-xl-row">
      {{ partial "course/sidebar-menu.html" (dict "context" .) }}

      <div class="documentation__content">
        <div class="documentation__content-wrapper">
          <div class="documentation__article-wrapper">

            {{ if not (eq .RelPermalink "/course/") }}
              {{ partial "documentation/breadcrumbs" . }}
            {{ end }}

            <article class="documentation-article">              
              {{ partial "article-content.html" . }}

              {{ $parent := .Parent }}
              {{ if and (or (eq .Params.isLesson true) (and $parent $parent.Params $parent.Params.isLesson)) (not (strings.Contains .RelPermalink "day-9")) }}
                <div class="pb-3 pt-4">
                  {{ $subject := site.GetPage "course" }}

                  {{ $section := cond .IsSection . .Parent }}
                  {{ $siblings := $section.RegularPages.ByWeight }}

                  {{ if .IsSection }}
                    {{ $first := index $siblings 0 }}
                    {{ if $first }}
                      {{ $segs := split (trim .RelPermalink "/") "/" }}
                      {{ $daySeg := cond (ge (len $segs) 3) (index $segs 2) "" }}
                      {{ $dayNum := replace $daySeg "day-" "" }}
                      <div class="mt-3">
                        <a href="{{ $first.RelPermalink }}" class="button button_contained">
                          {{ with $subject.Params.content.getStarted.text }}{{ . }}{{ else }}Get Started{{ end }}{{ if $dayNum }} Â· Day {{ $dayNum }}{{ end }}
                        </a>
                      </div>
                    {{ end }}
                  {{ else }}
                    {{ if not .IsSection }}
                      {{ $currentIndex := -1 }}
                      {{ range $i, $p := $siblings }}
                        {{ if eq $p.Permalink $.Permalink }}
                          {{ $currentIndex = $i }}
                        {{ end }}
                      {{ end }}

                      {{ $nextIndex := add $currentIndex 1 }}
                      {{ if and (ge $currentIndex 0) (lt $nextIndex (len $siblings)) }}
                        {{ $next := index $siblings $nextIndex }}
                        {{ $isPitstop := and $next $next.File (eq $next.File.BaseFileName "pitstop-project") }}
                        <div class="mt-4">
                          <h3 class="h6 mb-2">Next up: {{ $next.Title }}</h3>
                          <p>
                            {{ if $isPitstop }}
                              Time for the pitstop project. Apply todayâ€™s concepts and ship a small build. Letâ€™s build ðŸš€
                            {{ else }}
                              Continue to the next lesson and keep building. Letâ€™s build ðŸš€
                            {{ end }}
                          </p>
                          <a href="{{ $next.RelPermalink }}" class="button button_contained button_sm">Continue</a>
                        </div>
                      {{ else }}
                        {{ $sectionSiblings := sort (where $section.Parent.Pages "IsSection" true) "Weight" }}
                        {{ $currentSectionIndex := -1 }}
                        {{ range $i, $s := $sectionSiblings }}
                          {{ if and $s.File $section.File (eq $s.File.UniqueID $section.File.UniqueID) }}
                            {{ $currentSectionIndex = $i }}
                          {{ end }}
                        {{ end }}

                        {{ $nextSectionIndex := add $currentSectionIndex 1 }}
                        {{ if and (ge $currentSectionIndex 0) (lt $nextSectionIndex (len $sectionSiblings)) }}
                          {{ $nextSection := index $sectionSiblings $nextSectionIndex }}
                          {{ $firstOfNext := index ($nextSection.RegularPages.ByWeight) 0 }}
                          {{ if $firstOfNext }}
                                                      <div class="mt-4">
                            <h3 class="h6 mb-2">Next up: {{ $nextSection.Title }}</h3>
                            <p>Congratulations on finishing {{ $section.Title }}. Continue to the next day.</p>
                            <a href="{{ $nextSection.RelPermalink }}" class="button button_contained button_sm">Next day</a>
                          </div>
                          {{ end }}
                        {{ end }}
                      {{ end }}
                    {{ end }}
                  {{ end }}
                </div>
              {{ end }}
            </article>
          </div>

          {{ if not (eq .Params.isLesson true) }}
            {{ partial "table-of-contents" . }}
          {{ end }}

          {{ partial "documentation/footer.html" . }}
        </div>
      </div>
    </div>
  </div>
</section>
